{"meta":{"title":"Rapheal's Tech Blog","subtitle":"","description":"Raphael's Tech Blog","author":"Raphael","url":"http://example.com","root":"/"},"pages":[],"posts":[{"title":"Docker Stack Deploy","slug":"Docker-Stack-Deploy","date":"2021-02-04T08:16:23.000Z","updated":"2021-02-16T20:42:23.520Z","comments":true,"path":"2021/02/04/Docker-Stack-Deploy/","link":"","permalink":"http://example.com/2021/02/04/Docker-Stack-Deploy/","excerpt":"","text":"Note of the traps and the solutions: 1. RegistryPrivate Registryvideo ref bilan: Create or modify /etc/docker/daemon.json &#123; &quot;insecure-registries&quot;:[&quot;myregistry.example.com:5000&quot;] &#125; Restart docker daemon sudo service daemon-reload &amp;&amp; sudo service docker restart 2. Container networking and DNS servicesDocker Bridge NetworkPort MappingLinking Containers 3. Docker and iptablesMapping to external ip 4. Finding out what package a command came from : example $ dpkg -S &#39;systemd-resolve&#39; systemd: /usr/share/bash-completion/completions/systemd-resolve systemd: /usr/share/man/man8/systemd-resolved.8.gz systemd: /lib/systemd/systemd-resolved systemd: /lib/systemd/system/systemd-resolved.service systemd: /usr/bin/systemd-resolve systemd: /usr/share/man/man8/systemd-resolved.service.8.gz $ dpkg -s systemd Package: systemd Status: install ok installed Priority: important Section: admin Installed-Size: 15084 ..... Description: system and service manager systemd is a system and service... 5. What DNS servers am I using? Both of the follows worked for me : $ nmcli dev show $ systemd-resolve --statusll 6. Auto SSH Login raf@Atua:~$ ssh-keygen -f ~/.ssh/ThinkPad-X240s -t ecdsa -b 521 raf@Atua:~$ ssh-copy-id -i ~/.ssh/ThinkPad-X240s.pub raf@192.168.1.29 7. Docker: Where is “reset to factory defaults” on linux? $ sudo rm -rf /var/lib/docker 8. Enabling GPU access with Compose9. Connect to Naco-Registry $ docker logs --details mall-admin 2021-02-16 09:03:12.221 ERROR 1 --- [ main] c.a.n.c.config.http.ServerHttpAgent : [NACOS SocketTimeoutException httpGet] currentServerAddr:http://nacos-registry:8848， err : connect timed out $ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 Atua 127.0.0.1 registry.atua.com 192.168.1.29 db 192.168.1.29 nacos-registry 192.168.1.29 redis 192.168.1.29 mongo 192.168.1.29 rabbit $ ping nacos-registry PING nacos-registry (192.168.1.29) 56(84) bytes of data. 64 bytes from db (192.168.1.29): icmp_seq=1 ttl=64 time=65.3 ms http://nacos-registry:8848/nacos/ username/password: nacos/nacos 10. /usr/lib/systemd/system/docker.serviceSometimes, the modification of ExecStart makes restart docker failed. ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock This fixed my problem: $ docker ps Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? $ sudo systemctl stop docker.socket $ sudo systemctl daemon-reload $ sudo systemctl restart docker The log of systemd may help as well: $ journalctl -f 11. Docker container log $ docker logs mall-admin --since 40 | less 12. listener on a port $ netstat -tln 13. mysql client connect to remote mysql server $ mysql -uroot -proot --default-character-set=utf8 -h db 14. connect to remote Redis server $ redis-cli -h redis -p 6379","categories":[],"tags":[]}],"categories":[],"tags":[]}